<!-- Productos Overview Page -->
<section class="section-stack bg-gradient-to-b from-[#0a0b0d] to-[#13151a] min-h-screen">
  <!-- Page Header Component -->
  <app-page-header
    title="{{ 'products.hero.title' | translate }}"
    subtitle="{{ 'products.hero.subtitle' | translate }}"
    [breadcrumbs]="breadcrumbs"
    icon="products">
  </app-page-header>

  <!-- Filters Section -->
  <div class="page-container pb-12">
    <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl shadow-bitcoin-lg p-6 mb-12">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
        <!-- Category Filter -->
        <div>
          <label for="categoryFilter" class="block text-sm font-medium text-bitcoin-gray mb-2">
            {{ 'products.filters.category' | translate }}
          </label>
          <select id="categoryFilter"
                  [(ngModel)]="selectedCategoryId"
                  (change)="onCategoryChange()"
                  class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-bitcoin-gray rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange transition-all">
            <option value="">{{ 'products.filters.all_categories' | translate }}</option>
            @for (category of categories; track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>

        <!-- Model Filter -->
        <div>
          <label for="modelFilter" class="block text-sm font-medium text-bitcoin-gray mb-2">
            {{ 'products.filters.model' | translate }}
          </label>
          <select id="modelFilter"
                  [(ngModel)]="selectedModelId"
                  (change)="onModelChange()"
                  class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-bitcoin-gray rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange transition-all">
            <option value="">{{ 'products.filters.all_models' | translate }}</option>
            @for (model of models; track model.id) {
              <option [value]="model.id">{{ model.name }}</option>
            }
          </select>
        </div>

        <!-- Search Filter -->
        <div>
          <label for="searchFilter" class="block text-sm font-medium text-bitcoin-gray mb-2">
            {{ 'products.filters.search' | translate }}
          </label>
          <input type="text"
                 id="searchFilter"
                 [(ngModel)]="searchTerm"
                 (input)="onSearchChange()"
                 [placeholder]="'products.filters.search_placeholder' | translate"
                 class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-bitcoin-gray placeholder-bitcoin-gray/50 rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange transition-all"/>
        </div>

        <!-- Clear Filters Button -->
        <div>
          @if (hasFilters) {
            <button (click)="clearFilters()"
                    class="w-full px-4 py-2.5 bg-bitcoin-dark/60 hover:bg-bitcoin-dark/80 border border-bitcoin-gray/20 text-bitcoin-gray rounded-lg font-medium transition-colors">
              {{ 'products.filters.clear_filters' | translate }}
            </button>
          }
        </div>
      </div>

      <!-- Tags Filter -->
      @if (allTags.length > 0) {
        <div class="mt-4 pt-4 border-t border-bitcoin-orange/20">
          <label class="block text-sm font-medium text-bitcoin-gray mb-3">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
              </svg>
              {{ 'products.filters.filter_by_tags' | translate }}
            </span>
          </label>
          <div class="flex flex-wrap gap-2">
            @for (tagSlug of allTags; track tagSlug) {
              <button
                type="button"
                (click)="toggleTag(tagSlug)"
                [style.background-color]="isTagSelected(tagSlug) ? getTagColor(tagSlug) : 'transparent'"
                [style.color]="isTagSelected(tagSlug) ? '#FFFFFF' : getTagColor(tagSlug)"
                [style.border-color]="getTagColor(tagSlug)"
                class="px-3 py-1.5 border rounded-full text-sm font-medium transition-all hover:scale-105">
                {{ getTagName(tagSlug) }}
              </button>
            }
          </div>
        </div>
      }

      <!-- Results Count -->
      <div class="mt-4 pt-4 border-t border-bitcoin-orange/20">
        <p class="text-sm text-bitcoin-gray/70">
          @if (isLoading) {
            {{ 'products.results.loading' | translate }}
          } @else {
            {{ 'products.results.showing' | translate : { current: filteredProductsCount, total: totalProductsCount } }}
          }
        </p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="page-container pb-20 text-center">
      <div class="inline-flex items-center gap-3 px-6 py-4 bg-bitcoin-dark/60 backdrop-blur-md border border-bitcoin-orange/20 rounded-full shadow-bitcoin">
        <div class="app-spinner" style="--spinner-size: 72px;"><img src="/Logo Clear.png" alt="Loading" width="96" height="96"></div>
        <span class="text-bitcoin-gray font-medium">{{ 'products.results.loading' | translate }}</span>
      </div>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading && filteredProducts.length === 0) {
    <div class="page-container pb-20 text-center">
      <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl shadow-bitcoin-lg p-12">
        <svg class="w-16 h-16 text-bitcoin-gray/50 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
        </svg>
        <h3 class="font-serif text-2xl bitcoin-gradient-text mb-2">{{ 'products.empty.title' | translate }}</h3>
        <p class="text-bitcoin-gray/70 mb-6">{{ 'products.empty.message' | translate }}</p>
        @if (hasFilters) {
          <button (click)="clearFilters()"
                  class="px-6 py-3 bg-bitcoin-orange/30 hover:bg-bitcoin-orange/40 border border-bitcoin-orange/30 text-bitcoin-orange rounded-full font-semibold transition-colors">
            {{ 'products.empty.clear_button' | translate }}
          </button>
        }
      </div>
    </div>
  }

  <!-- Products by Thickness -->
  @if (!isLoading && filteredProducts.length > 0) {
    <div class="page-container pb-20">
      
      <!-- All Filtered Products -->
      <section class="mb-20">
        <div class="mb-8">
          <h2 class="font-serif text-4xl bitcoin-gradient-text mb-2">{{ 'products.section.title' | translate }}</h2>
          <p class="text-lg text-bitcoin-gray">{{ 'products.section.subtitle' | translate }}</p>
        </div>
        
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-8">
          @for (producto of filteredProducts; track producto.slug) {
            <article
              class="group relative flex h-full cursor-pointer flex-col overflow-hidden rounded-2xl border border-bitcoin-gray/25 bg-bitcoin-dark/60 backdrop-blur-sm shadow-bitcoin transition-all duration-300 hover:-translate-y-1 hover:border-bitcoin-orange/50 hover:shadow-bitcoin-lg focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-bitcoin-orange"
              tabindex="0"
              role="link"
              [attr.aria-label]="producto.name"
              (click)="goToProduct(producto)"
              (keydown.enter)="goToProduct(producto, $event)"
              (keydown.space)="goToProduct(producto, $event)">
              <div class="aspect-[4/3] overflow-hidden bg-bitcoin-dark/70">
                @if (producto.imageUrl) {
                  <img
                    [src]="producto.imageUrl"
                    [alt]="producto.name"
                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                    loading="lazy"/>
                } @else {
                  <div class="flex h-full w-full items-center justify-center text-white/40">
                    <svg class="h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                  </div>
                }
              </div>
              <div class="flex flex-1 flex-col p-6">
                <h3 class="mb-3 font-serif text-2xl tracking-tight text-white/90">{{producto.name}}</h3>

                <!-- Category and Model Badges -->
                <div class="mb-4 flex flex-wrap gap-2">
                  @if (getCategoryName(producto.categoryId)) {
                    <span class="rounded border border-bitcoin-gold/30 bg-bitcoin-gold/15 px-2 py-1 text-xs font-medium uppercase tracking-wide text-bitcoin-gold">
                      {{getCategoryName(producto.categoryId)}}
                    </span>
                  }
                  @if (getModelName(producto.modelId)) {
                    <span class="rounded border border-bitcoin-orange/30 bg-bitcoin-orange/15 px-2 py-1 text-xs font-medium uppercase tracking-wide text-bitcoin-orange">
                      {{getModelName(producto.modelId)}}
                    </span>
                  }
                </div>

                @if (producto.description) {
                  <p class="mb-4 line-clamp-3 text-sm text-white/70">
                    {{producto.description}}
                  </p>
                }

                <!-- Stock Badge -->
                @if (producto.stock !== undefined) {
                  <div class="mb-4">
                    <span
                      class="inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold"
                      [class]="producto.stock > 10 ? 'bg-emerald-100 text-emerald-800' : producto.stock > 0 ? 'bg-amber-100 text-amber-800' : 'bg-rose-100 text-rose-800'">
                      <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <circle cx="10" cy="10" r="8"/>
                      </svg>
                      {{ producto.stock > 0 ? producto.stock + ' en stock' : 'Sin stock' }}
                    </span>
                  </div>
                }

                @if (producto.price) {
                  <p class="mb-6 text-lg font-semibold text-bitcoin-gold">{{producto.price | currency:'USD':'symbol':'1.2-2'}}</p>
                }

                <div class="mt-auto flex items-center justify-between gap-3 pt-2">
                  <div class="inline-flex items-center gap-2 text-sm font-semibold text-bitcoin-orange transition-colors group-hover:text-bitcoin-gold">
                    <span>View product</span>
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                  </div>
                  <button
                    (click)="addToCart(producto, $event)"
                    class="inline-flex items-center justify-center rounded-lg border border-bitcoin-orange/40 bg-bitcoin-orange/80 px-4 py-2 text-sm font-semibold text-[#0a0b0d] transition-colors hover:bg-bitcoin-orange focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-bitcoin-orange">
                    Add to Cart
                  </button>
                </div>
              </div>
            </article>
          }
        </div>
      </section>

      <!-- Call to Action -->
      <section class="text-center py-16">
        <div class="max-w-3xl mx-auto">
          <h2 class="font-serif text-3xl bitcoin-gradient-text mb-4">
            Need Personalized Consultation?
          </h2>
          <p class="text-lg text-bitcoin-gray mb-8">
            Our team of mining experts will help you choose the perfect hardware for your operation.
          </p>
          <div class="flex justify-center">
            <a routerLink="/contacto" 
               class="inline-flex items-center gap-2 px-8 py-4 bg-bitcoin-orange/30 hover:bg-bitcoin-orange/40 border border-bitcoin-orange/30 text-bitcoin-orange rounded-full font-semibold transition-colors shadow-bitcoin">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.955 8.955 0 01-3.793-.793L3 21l1.793-6.207A8.955 8.955 0 013 12a8 8 0 018-8c4.418 0 8 3.582 8 8z"/>
              </svg>
              Request Consultation
            </a>
          </div>
        </div>
      </section>
    </div>
  }
</section>

