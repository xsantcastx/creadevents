<div class="project-detail-page">
  @if (project()) {
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-image">
        <img [src]="project()!.heroImage" [alt]="project()!.title" loading="eager">
        <div class="hero-overlay">
          <div class="hero-content">
            <div class="breadcrumb">
              <a routerLink="/portfolio">Portfolio</a>
              <span class="divider">‚Ä∫</span>
              <span>{{ project()!.title }}</span>
            </div>
            <h1 class="hero-title">{{ project()!.title }}</h1>
            <div class="project-meta">
              <span class="project-type">{{ getEventTypeLabel(project()!.eventType) }}</span>
              @if (project()!.location) {
                <span class="project-location">üìç {{ project()!.location }}</span>
              }
              <span class="project-date">{{ formatDate(project()!.date) }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Project Details -->
    <section class="project-content">
      <div class="container">
        <div class="content-grid">
          
          <!-- Main Content -->
          <div class="main-content">
            @if (project()!.description) {
              <div class="project-story">
                <h2>The Story</h2>
                <p>{{ project()!.description }}</p>
              </div>
            }

            <!-- Gallery -->
            <div class="project-gallery">
              <h2>Event Gallery</h2>
              <div class="gallery-grid">
                @for (image of project()!.gallery; track image; let i = $index) {
                  <div 
                    class="gallery-item" 
                    [class.large]="i % 6 === 0"
                    (click)="openLightbox(i)">
                    <img [src]="image" [alt]="'Gallery image ' + (i + 1)" loading="lazy">
                    <div class="gallery-overlay">
                      <i class="view-icon">üëÅ</i>
                    </div>
                  </div>
                }
              </div>
            </div>

            <!-- Testimonial Section -->
            @if (projectTestimonial()) {
              <div class="testimonial-section">
                <h2>Client Testimonial</h2>
                <div class="testimonial-card">
                  <div class="quote-mark">"</div>
                  <blockquote>{{ projectTestimonial()!.quote }}</blockquote>
                  <div class="testimonial-author">
                    @if (projectTestimonial()!.photo) {
                      <img [src]="projectTestimonial()!.photo" [alt]="projectTestimonial()!.author">
                    }
                    <div class="author-info">
                      <div class="author-name">{{ projectTestimonial()!.author }}</div>
                      @if (projectTestimonial()!.role) {
                        <div class="author-role">{{ projectTestimonial()!.role }}</div>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>

          <!-- Sidebar -->
          <div class="sidebar">
            
            <!-- Project Details Card -->
            <div class="details-card">
              <h3>Project Details</h3>
              <div class="details-list">
                <div class="detail-item">
                  <span class="label">Event Type:</span>
                  <span class="value">{{ getEventTypeLabel(project()!.eventType) }}</span>
                </div>
                
                <div class="detail-item">
                  <span class="label">Date:</span>
                  <span class="value">{{ formatDate(project()!.date) }}</span>
                </div>
                
                @if (project()!.location) {
                  <div class="detail-item">
                    <span class="label">Location:</span>
                    <span class="value">{{ project()!.location }}</span>
                  </div>
                }
                
                @if (project()!.venue) {
                  <div class="detail-item">
                    <span class="label">Venue:</span>
                    <span class="value">{{ project()!.venue }}</span>
                  </div>
                }
                
                @if (project()!.season.length > 0) {
                  <div class="detail-item">
                    <span class="label">Season:</span>
                    <span class="value">{{ project()!.season.join(', ') | titlecase }}</span>
                  </div>
                }
                
                @if (project()!.palette.length > 0) {
                  <div class="detail-item">
                    <span class="label">Color Palette:</span>
                    <div class="color-swatches">
                      @for (color of project()!.palette.slice(0, 5); track color) {
                        <div class="color-swatch" [style.background-color]="color" [title]="color"></div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>

            <!-- Florals Used -->
            @if (project()?.floralsUsed && project()!.floralsUsed!.length > 0) {
              <div class="florals-card">
                <h3>Florals Featured</h3>
                <div class="florals-list">
                  @for (floral of project()!.floralsUsed!; track floral) {
                    <span class="floral-tag">{{ floral }}</span>
                  }
                </div>
              </div>
            }

            <!-- Call to Action -->
            <div class="cta-card">
              <h3>Love This Style?</h3>
              <p>Let us create something similar for your special event.</p>
              <div class="cta-actions">
                <a routerLink="/contact" class="btn btn-primary">Get a Quote</a>
                <a href="tel:7863562958" class="btn btn-outline">Call Us</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Related Projects -->
    <section class="related-projects">
      <div class="container">
        <h2>Similar Projects</h2>
        @if (relatedProjects().length > 0) {
          <div class="related-grid">
            @for (relatedProject of relatedProjects(); track relatedProject.id) {
              <a [routerLink]="['/portfolio', relatedProject.slug]" class="related-item">
                <div class="related-image">
                  <img [src]="relatedProject.heroImage" [alt]="relatedProject.title" loading="lazy">
                </div>
                <div class="related-info">
                  <h4>{{ relatedProject.title }}</h4>
                  <p>{{ getEventTypeLabel(relatedProject.eventType) }}</p>
                </div>
              </a>
            }
          </div>
        } @else {
          <div class="no-related">
            <p>Check out our <a routerLink="/portfolio">full portfolio</a> for more inspiration.</p>
          </div>
        }
      </div>
    </section>

  } @else if (loading()) {
    <div class="loading-state">
      <div class="container">
        <h1>Loading project...</h1>
      </div>
    </div>
  } @else {
    <div class="error-state">
      <div class="container">
        <h1>Project not found</h1>
        <p>The project you're looking for doesn't exist or has been removed.</p>
        <a routerLink="/portfolio" class="btn btn-primary">Back to Portfolio</a>
      </div>
    </div>
  }

  <!-- Navigation -->
  <section class="project-navigation">
    <div class="container">
      <div class="nav-actions">
        <button (click)="goBack()" class="btn btn-outline">
          ‚Üê Back to Portfolio
        </button>
        <div class="share-actions">
          <span>Share this project:</span>
          <button (click)="shareProject('facebook')" class="share-btn facebook">Facebook</button>
          <button (click)="shareProject('twitter')" class="share-btn twitter">Twitter</button>
          <button (click)="shareProject('email')" class="share-btn email">Email</button>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Lightbox Modal -->
@if (lightboxOpen()) {
  <div class="lightbox-overlay" (click)="closeLightbox()">
    <div class="lightbox-container" (click)="$event.stopPropagation()">
      <button class="lightbox-close" (click)="closeLightbox()">√ó</button>
      
      @if (project()) {
        <div class="lightbox-image">
          <img [src]="project()!.gallery[currentImageIndex()]" [alt]="'Gallery image ' + (currentImageIndex() + 1)">
        </div>
        
        <div class="lightbox-info">
          <h3>{{ project()!.title }}</h3>
          <p>Image {{ currentImageIndex() + 1 }} of {{ project()!.gallery.length }}</p>
        </div>
        
        <!-- Navigation -->
        @if (project()!.gallery.length > 1) {
          <button 
            class="lightbox-nav prev" 
            (click)="previousImage()" 
            [disabled]="currentImageIndex() === 0">
            ‚Äπ
          </button>
          <button 
            class="lightbox-nav next" 
            (click)="nextImage()" 
            [disabled]="currentImageIndex() === project()!.gallery.length - 1">
            ‚Ä∫
          </button>
        }
      }
    </div>
  </div>
}