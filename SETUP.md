# Template Setup Guide

This guide will walk you through setting up your own store using this template.

## Prerequisites

- Node.js 20.x or higher
- npm
- Firebase CLI (`npm install -g firebase-tools`)
- A Firebase project
- A Stripe account (if using payments)

## Initial Setup

### 1. Clone and Install

```bash
git clone <your-template-repo-url>
cd <your-project-folder>
npm install
cd functions && npm install && cd ..
```

### 2. Configure Your Brand

The template uses a brand configuration system. Start by customizing the default brand:

```bash
# Edit these files in config/brands/default/
- site.json         # Your brand name, colors, contact info
- features.json     # Enable/disable features (blog, newsletter, etc.)
- backend.json      # Backend service toggles
- emails.json       # Email templates content
```

Or create a new brand:

```bash
cp -r config/brands/default config/brands/your-brand-name
# Then set APP_BRAND_KEY=your-brand-name in .env
```

### 3. Set Up Environment Variables

```bash
cp .env.example .env
```

Edit `.env` and fill in your values:

**Firebase Configuration** (Get from Firebase Console > Project Settings):
- `FIREBASE_API_KEY`
- `FIREBASE_AUTH_DOMAIN`
- `FIREBASE_PROJECT_ID`
- `FIREBASE_STORAGE_BUCKET`
- `FIREBASE_MESSAGING_SENDER_ID`
- `FIREBASE_APP_ID`
- `FIREBASE_MEASUREMENT_ID`

**Stripe Configuration** (if using payments):
- `STRIPE_PUBLIC_KEY`
- `STRIPE_SECRET_KEY`
- `STRIPE_WEBHOOK_SECRET`
- `PRICE_ID_MAIN`
- `PRICE_ID_DONATION_OPTIONAL`

**Email Service** (if using Brevo):
- `BREVO_API_KEY`
- `BREVO_LIST_ID`
- `BREVO_TEMPLATE_ID_ORDER`
- `BREVO_TEMPLATE_ID_NEWSLETTER_WELCOME`

**App Identity**:
- `APP_NAME` - Your store name
- `APP_URL` - Your production URL
- `APP_BRAND_KEY` - Brand folder name (e.g., "default")
- `FUNCTIONS_NAMESPACE` - Unique namespace for your cloud functions

### 4. Configure Firebase Project

**Important:** The `.firebaserc` file is gitignored to prevent accidentally committing your real project ID.

```bash
# Copy the example file
cp .firebaserc.example .firebaserc

# Login to Firebase (if not already logged in)
firebase login

# Add your Firebase project
firebase use --add
# Select your project from the list

# Verify the correct project is set
firebase use default
```

Alternatively, manually edit `.firebaserc` and replace `your-firebase-project-id` with your actual Firebase project ID.

### 5. Deploy Firestore Rules and Indexes

```bash
firebase deploy --only firestore:rules
firebase deploy --only firestore:indexes
firebase deploy --only storage
```

### 6. Set Up Cloud Functions (Optional)

If using backend features:

```bash
cd functions
npm install
firebase deploy --only functions
cd ..
```

## Development

### Run Locally

```bash
npm start
# Or with custom port
ng serve --port 4200
```

The app will automatically:
1. Run `template:sync` to generate config files
2. Start the development server at `http://localhost:4200`

### Build for Production

```bash
npm run build
```

Output will be in `dist/commerce-template/browser`

### Deploy to Firebase Hosting

```bash
npm run deploy
# Or
firebase deploy --only hosting
```

## Key Configuration Files

| File | Purpose |
|------|---------|
| `.env` | Secrets and API keys (never commit!) |
| `.firebaserc` | Firebase project configuration |
| `config/brands/*/site.json` | Brand identity, colors, contact info |
| `config/brands/*/features.json` | Feature flags for frontend |
| `config/brands/*/backend.json` | Backend service toggles |
| `config/brands/*/emails.json` | Email template content |

## Generated Files (Don't Edit Directly)

These are auto-generated by `npm run template:sync`:
- `src/config-loader/generated/*`
- `src/environments/environment.generated.ts`
- `functions/src/config/backend.flags.ts`

## Customization Tips

### Change Project Name

1. Update `package.json` - change `"name": "commerce-template"` to your project name
2. Update `angular.json` - change project key from `commerce-template` to your name
3. Update `firebase.json` - change hosting public path to match
4. Update `package.json` serve:ssr script to match new name

### Add/Remove Features

Edit `config/brands/your-brand/features.json`:

```json
{
  "blog": true,           // Enable blog section
  "newsletter": true,     // Newsletter signup
  "donations": false,     // Donation feature
  "reviews": true,        // Product reviews
  "maintenanceMode": false
}
```

### Customize Theme

Edit `config/brands/your-brand/site.json` under `theme.tokens`:

```json
{
  "theme": {
    "tokens": {
      "color-primary": "#3b82f6",
      "color-secondary": "#8b5cf6",
      "font-family-heading": "'Inter', sans-serif"
    }
  }
}
```

## Troubleshooting

### Build fails with "Cannot find module"
Run `npm run template:sync` manually to ensure all generated files exist.

### Firebase deployment fails
1. Check `.firebaserc` has correct project ID
2. Run `firebase login` to authenticate
3. Verify you have permission to deploy to the project

### Features not appearing
1. Check `features.json` has the feature enabled
2. Run `npm run template:sync`
3. Restart dev server

## Next Steps

- Set up Stripe webhooks (see `docs/integrations/STRIPE_WEBHOOK_SETUP.md`)
- Configure Brevo email templates (see `docs/integrations/BREVO_SETUP.md`)
- Set up reCAPTCHA (see `docs/configuration/RECAPTCHA_SETUP.md`)
- Configure App Check (see `docs/configuration/APP_CHECK_SETUP.md`)
- Review security rules (see `docs/configuration/STORAGE_RULES_UPDATE.md`)

For more detailed documentation, see the `docs/` directory.
